# 售后演示脚本（客户演示用）

## 演示目标
- 演示完整售后闭环：用户提交→运营审核→退款/拒绝→完成；包含取消与两种退款类型（不退货/退货退款）。

## 角色与环境
- 角色：用户（小程序端）、运营（管理后台）。
- 管理端页面：`litemall-admin/src/views/mall/aftersale.vue`
- 用户端接口控制器：`litemall-wx-api/src/main/java/org/linlinjava/litemall/wx/web/WxAftersaleController.java`
- 管理端接口控制器：`litemall-admin-api/src/main/java/org/linlinjava/litemall/admin/web/AdminAftersaleController.java`

## 演示前准备
- 准备一笔“已完成”的订单（用户已确认收货或自动确认）。
  - 订单完成状态判断：`litemall-db/src/main/java/org/linlinjava/litemall/db/util/OrderUtil.java`；用户确认入口见 `WxOrderController.confirm`。
- 退款金额上限：不超过订单“实付金额−运费”。
- 可选：准备1–3张凭证图片，演示上传与展示。

## 场景A：不退货退款（TYPE_GOODS_NEEDLESS）
- 用户端操作：
  - 打开“申请售后”页面，选择订单，填写：
    - 类型：不退货退款
    - 原因：示例“收到商品有瑕疵”
    - 金额：不超过上限
    - 凭证：上传图片
  - 点击提交，调用 `POST /wx/aftersale/submit`（`WxAftersaleController.java:117-160`）。
- 讲解要点：
  - 系统校验订单完成与金额上限；生成售后编号，售后状态置为申请（`STATUS_REQUEST`），订单 `aftersaleStatus` 同步（`LitemallOrderService.updateAftersaleStatus`）。
- 管理端操作：
  - 进入“商城管理→售后管理”，按订单ID或售后编号查询。
  - 在申请中的记录上点击“审核通过”，调用 `POST /admin/aftersale/recept`（`AdminAftersaleController.java:71-89`）。状态转为受理（`STATUS_RECEPT`）。
  - 点击“退款”，调用 `POST /admin/aftersale/refund`（`AdminAftersaleController.java:167-231`）。完成微信退款，售后状态转为退款（`STATUS_REFUND`），订单同步，短信通知（`NotifyType.REFUND`）。
- 可视化：
  - 管理端详情弹框查看凭证图片与状态时间；用户端在售后列表与详情看到状态变更。

## 场景B：退货退款（TYPE_GOODS_REQUIRED）
- 用户端提交：同上，类型选择“退货退款”。
- 管理端操作：
  - 审核通过→退款。
  - 讲解要点：退款成功后系统为对应货品增加库存（`AdminAftersaleController.java:214-221`）。
  - 提示：收货环节由业务线下完成，系统在退款成功时执行入库逻辑。

## 场景C：审核拒绝
- 管理端在“申请”态点击“审核拒绝”，调用 `POST /admin/aftersale/reject`（`AdminAftersaleController.java:121-139`）。
- 效果：售后状态转为拒绝（`STATUS_REJECT`），订单同步；用户端列表/详情显示“已拒绝”。

## 场景D：用户取消申请
- 前提：售后仍在申请态。
- 用户端在详情页点击“取消”，调用 `POST /wx/aftersale/cancel`（`WxAftersaleController.java:171-207`）。
- 效果：售后状态转为取消（`STATUS_CANCEL`），订单同步；管理端列表中状态更新为取消。

## 现场讲解提示
- 状态与类型常量：`litemall-db/src/main/java/org/linlinjava/litemall/db/util/AftersaleConstant.java:4-13`
- 订单售后状态同步：`litemall-db/src/main/java/org/linlinjava/litemall/db/service/LitemallOrderService.java:204-210`
- 管理端前端交互：
  - 审核通过：`litemall-admin/src/views/mall/aftersale.vue:192-207`
  - 审核拒绝：`litemall-admin/src/views/mall/aftersale.vue:232-247`
  - 退款操作：`litemall-admin/src/views/mall/aftersale.vue:272-287`
- 短信通知类型：`litemall-core/src/main/java/org/linlinjava/litemall/core/notify/NotifyType.java:3-8`

## 演示技巧
- 金额示例：设置为接近上限，便于说明校验逻辑。
- 图片示例：上传清晰凭证，管理端详情可放大查看。
- 批量操作：在管理端勾选多条，演示批量通过/拒绝（列表顶部按钮）。
- 讲清同步：每次状态变更，订单 `aftersaleStatus` 与售后记录 `status` 同步更新。
