# 售后处理流程

## 业务逻辑
- 适用范围：订单整体售后，不支持单个商品售后
- 入口：小程序端提交售后类型、原因、凭证图片与退款金额
- 前置条件：订单已完成（确认或自动确认），退款金额不超过实付减运费，订单当前售后状态不是已受理或已退款
- 状态与类型：
  - 状态：初始化→申请→受理→退款/拒绝→完成/取消
  - 类型：未收货退款、不退货退款、退货退款
- 审核：运营在管理端审核通过/拒绝，支持批量操作
- 退款：运营在管理端发起微信退款；“退货退款”类型成功后增加库存；短信通知用户
- 取消：用户在待审核（申请）状态可取消售后
- 同步规则：订单 `aftersaleStatus` 与售后记录 `status` 保持一致
- 展示：管理端列表/详情；用户端列表/详情

## 代码运作
- 用户端接口（`litemall-wx-api`）：
  - `GET /wx/aftersale/list` 查询列表
  - `GET /wx/aftersale/detail` 查看详情
  - `POST /wx/aftersale/submit` 提交售后，校验订单完成与金额上限，置状态为申请并同步订单
  - `POST /wx/aftersale/cancel` 取消售后，仅在申请态允许，置状态为取消并同步订单
- 管理端接口（`litemall-admin-api`）：
  - `GET /admin/aftersale/list` 条件查询售后记录
  - `POST /admin/aftersale/recept` 审核通过，置状态为受理并同步订单
  - `POST /admin/aftersale/batch-recept` 批量审核通过
  - `POST /admin/aftersale/reject` 审核拒绝，置状态为拒绝并同步订单
  - `POST /admin/aftersale/batch-reject` 批量审核拒绝
  - `POST /admin/aftersale/refund` 微信退款成功后置状态为退款并同步订单；若为退货退款类型则入库；短信通知用户
- 核心常量：`AftersaleConstant` 定义售后状态与类型
- 订单同步：`LitemallOrderService.updateAftersaleStatus` 更新订单 `aftersaleStatus`
- 管理端前端（`litemall-admin`）：
  - 页面：`src/views/mall/aftersale.vue` 列表/筛选/批量与单条操作、退款
  - 接口封装：`src/api/aftersale.js` 提供列表、审核与退款 API 调用
- 小程序前端（`litemall-wx`）：
  - 页面：`pages/ucenter/aftersale` 申请、`aftersaleList` 列表、`aftersaleDetail` 详情
  - 上传凭证与接口常量：`config/api.js` 中 `AftersaleSubmit/AftersaleList/AftersaleDetail`
