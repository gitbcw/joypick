0. 项目目标与范围
目标

在 litemall 基础上实现以下闭环：

门店拉新 → 企业微信触达 → 注册

商品上架（运营驱动、绑定供应商、协议价/售价）
让我想想下午还要做什么事情。首先其实我们之前已经讲过了，就是说我们这边的几个模拟状态哦，我来看一下。
活动配置 → 海报/消息推送（企业微信） → 跳转商城

下单支付（微信支付）

订单履约（运营通知 + 供应商发货 + 录入快递单号 + 物流查询）

售后退款（企业微信客服入口 + 商城售后单 + 运营审核 + 供应商确认 + 原路退款）

非目标（先不做或可后置）

供应商自助后台（暂不做/后续演进）

自动发货/自动对接供应商 ERP（暂以人工为主）

完整的门店/店员 KPI 结算体系（可先做埋点与关联）

1. 现状对齐（litemall 与目标能力的差距）

这里按 litemall 常见能力来对齐（你可以快速核对：有的就跳过，没有的就做）。

1.1 litemall 通常已有

商品、类目、库存、订单、支付（基础）

管理后台（运营配置）

小程序端（用户下单）

促销/优惠券（部分版本有）

1.2 你这套 PRD 需要新增/改造的关键点

供应商模型：商品必须绑定供应商；订单履约要能定位到供应商

协议价/结算价：用户售价之外，需要内部结算/协议价（用于对账/结算）

门店&店员&拉新链路：扫码关注企业微信 → 推新人优惠/注册链接 → 归因到门店/店员

企业微信集成：消息触达、客服入口、拉新二维码（活码/渠道码）

活动海报：后台配置活动 → 生成海报 → 海报跳转商城

履约流程差异：运营驱动通知供应商发货；供应商回传快递单号；运营录入/系统通知

售后流程差异：企业微信做客服入口；商城里形成售后单；运营审核；退货单号；供应商确认；微信原路退款

物流查询计费提示：你图里提到“查询物流需要费用”，至少要做“查询开关/频控/成本记录”

2. 任务拆分总览（Epic 列表）

Epic A：领域模型与数据库扩展（供应商/门店/店员/归因/协议价）

Epic B：企业微信（WeCom）集成（拉新、消息、客服）

Epic C：活动系统与海报投放（配置、生成、跳转、推送）

Epic D：订单履约改造（运营驱动发货、快递单号录入、状态机）

Epic E：售后与退款闭环（售后单、审核流、退货、原路退款）

Epic F：小程序端改造（注册/归因、活动落地页、订单/售后体验）

Epic G：管理后台改造（供应商、商品、活动、订单、售后操作台）

Epic H：基础设施与治理（权限、审计、配置中心、监控告警、对账导出）

下面我把每个 Epic 拆到 Task 级别。

Epic A：领域模型与数据库扩展
A1. 供应商实体与关联

Tasks

新增表：supplier（供应商基础信息、联系人、结算信息、状态）

商品关联供应商：goods.supplier_id

订单关联供应商：下单时按商品写入订单行/订单供应商字段（支持一个订单多供应商：建议订单商品表 order_goods 关联 supplier_id）

管理后台：供应商 CRUD

验收标准

商品必须选择供应商才能上架

订单明细能看到供应商

可按供应商筛选订单/售后

A2. 协议价/结算价模型

Tasks

goods_product 或 goods 增加字段：settlement_price（协议/结算价）

下单锁价：订单商品行记录 sale_price 与 settlement_price

后台导出对账：按时间/供应商导出（订单行级）

验收标准

用户侧只展示 sale_price

后台可查看/导出 settlement_price

订单生成后改价不影响历史订单锁价

A3. 门店、店员、会员归因

Tasks

新增表：store（门店信息）

新增表：clerk（店员、所属门店、企微userid/openid映射）

新增表：member_attribution（用户与门店/店员绑定、渠道、首次绑定时间）

小程序注册/登录时支持携带 scene 或 channel_id，落库归因

验收标准

用户能被归因到门店/店员

后台可按门店/店员查看拉新/注册/订单数据（先做列表导出也行）

Epic B：企业微信（WeCom）集成
B1. 基础鉴权与通用 SDK

Tasks

配置项：corpId、agentId、secret、token、aesKey（按环境区分）

获取/刷新 access_token（缓存、过期处理）

通用 HTTP Client + 重试 + 日志脱敏

验收标准

可稳定获取 token

接口失败有可追踪日志（traceId）

B2. 渠道活码/二维码拉新

Tasks

支持创建“渠道码”（用于门店/店员归因）

渠道码参数入库（storeId、clerkId、活动Id等）

用户通过企微添加/关注事件回调处理（需要回调服务器）

触达欢迎语：推新人优惠/注册链接

验收标准

不同门店/店员二维码能区分归因

新用户触发欢迎推送，内容可配置

B3. 消息推送（活动/新品海报）

Tasks

支持给单个用户/用户标签/人群推送（先实现“按用户列表推送”即可）

推送内容类型：文本 + 图片/图文 + 小程序卡片（跳转商城）

推送记录表：wecom_message_log

验收标准

后台可发起一次推送并看到成功/失败统计

推送可携带跳转到商城的参数

B4. 企微客服入口（售后咨询）

Tasks

用户侧：提供“联系客服/售后咨询”入口（跳转企微/展示客服二维码）

会话记录：至少记录用户触发入口行为（不强求聊天全文存储）

验收标准

用户可一键找到售后入口

后台可看到用户发起售后咨询的时间与订单关联（如能关联）

Epic C：活动系统与海报投放
C1. 活动配置（新人优惠/折扣海报）

Tasks

活动表：campaign（类型、时间、规则、素材、状态）

新人优惠规则：注册后自动发券/自动生成权益（依赖 litemall 优惠券能力）

活动与商品关联（选品）

验收标准

后台可创建活动并配置生效时间

新注册用户自动获得新人优惠

C2. 海报生成与落地页

Tasks

海报素材管理：上传背景图、文案、二维码位

生成海报：合成图片（后端生成或用对象存储+前端合成）

海报二维码指向：小程序页面 + scene 参数（活动Id/渠道码）

验收标准

任一活动都能生成一张可用海报

扫码进入小程序落到正确活动页/商品页

Epic D：订单履约改造（运营驱动）
D1. 订单状态机扩展与事件通知

Tasks

明确状态：待支付→已支付→待发货→已发货→已完成（含售后中）

已支付后通知运营（站内消息/企微通知/邮件任选其一先落地）

订单操作审计：谁在什么时候做了发货/改状态

验收标准

支付后订单进入“待发货”

运营能收到待发货提醒

发货/改状态可追溯

D2. 发货流程：运营录入快递单号

Tasks

后台订单详情增加“发货”操作：选择物流公司+单号

写入发货信息到订单发货表

通知用户：发货成功（小程序订阅消息/站内消息，按你现有能力）

验收标准

运营可录入单号并触发状态变更

用户端可看到物流单号

D3. 物流查询与成本控制（可选但建议）

Tasks

物流查询开关、频控（例如同一单号 30min 内缓存）

记录查询次数与接口费用（如你们确实计费）

验收标准

不会因高频查询导致成本失控

可导出物流查询成本报表（至少可查日志）

Epic E：售后与退款闭环
E1. 售后单模型与入口

Tasks

售后单表：after_sale（类型：退货退款/仅退款；原因；金额；状态）

用户端发起售后：选择订单商品、填写原因、上传凭证

售后与订单/订单商品关联

验收标准

用户可提交售后申请并看到进度

售后单能定位到供应商

E2. 运营审核流

Tasks

后台售后列表：筛选（状态/供应商/时间）

审核操作：同意/拒绝、备注

同意后生成退货地址信息（从供应商/平台配置读取）

验收标准

审核动作会推进售后状态

拒绝需填写原因，用户可见

E3. 退货寄回与单号录入

Tasks

用户填写退货快递公司+单号

运营/供应商可查看退货物流（可复用物流查询模块）

供应商确认收货（先由运营代操作也可）

验收标准

售后单能记录退货单号

收货确认后进入“待退款”

E4. 微信原路退款

Tasks

对接微信支付退款 API（或复用 litemall 已有退款能力）

退款成功回写售后状态与订单状态

失败重试/人工处理入口

验收标准

退款走原支付渠道

退款结果可追溯（流水号、时间、操作者）

Epic F：小程序端改造
F1. 注册/登录携带归因参数

Tasks

扫码/分享进入小程序解析 scene

注册成功写入 member_attribution

用户个人中心展示“我的优惠券/新人权益”

验收标准

归因数据完整落库

新人权益可见可用

F2. 活动页/海报落地页

Tasks

活动聚合页：展示活动信息、选品列表

海报跳转后定位到对应活动

支持“一键购买/领券”

验收标准

任意活动链接都能正确落地

用户可从活动页顺畅下单

F3. 订单/物流/售后体验补齐

Tasks

订单详情展示物流单号与物流轨迹

售后入口：订单详情→申请售后

售后进度页

验收标准

用户可自助完成售后闭环操作

Epic G：管理后台改造（admin）
G1. 供应商管理

列表、详情、创建、禁用、结算信息维护

G2. 商品上架增强

商品编辑增加：供应商、协议价、活动标签

上架校验：缺供应商/缺素材不可上架（按你们规则）

G3. 活动管理与推送

活动 CRUD、海报生成、推送触达（企微）

G4. 订单履约工作台

待发货列表、快速录单号、按供应商筛选、导出

G5. 售后工作台

审核、退货单号、退款操作、状态推进、日志

验收标准（后台通用）

每个关键动作都有操作日志

列表可筛选、可导出（运营必需）

Epic H：基础设施与治理
H1. 权限与角色

Tasks

运营角色拆分：商品运营/活动运营/售后运营/管理员

数据权限：按供应商/门店过滤（如需要）

H2. 配置中心

企微配置、支付配置、物流配置、活动默认配置（环境隔离）

H3. 审计与可观测性

关键链路：注册、支付、发货、退款、企微推送成功率

报警：退款失败、企微 token 异常、支付回调失败

3. 建议的实施顺序（不含时间预估）

为了尽快跑通闭环，推荐按“先交易后增长”：

A1/A2 + D1/D2 + F3 + G4：先把“能卖、能发货”跑通

E1~E4 + G5：补齐售后退款闭环（很关键）

B1~B3 + C1~C2 + F1/F2 + G3：做拉新+活动增长

A3 + B2：门店店员归因精细化

H 系列：权限、审计、监控逐步补齐